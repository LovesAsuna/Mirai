plugins {
    id 'java'
    id 'com.github.johnrengelman.shadow' version '6.1.0'
    id 'org.jetbrains.kotlin.jvm' version '1.4.31'
    id "org.jetbrains.kotlin.plugin.serialization" version "1.4.31"
    id "org.jetbrains.kotlin.kapt" version "1.4.31"
}

description('一个基于Mirai的机器人')
group 'me.lovesasuna'
version '3.1.0'

ext {
    workDir = 'E:\\work\\Mirai-Console\\plugins'
    mirai_Version = '2.4.0'
}

sourceCompatibility = 8
targetCompatibility = 8

repositories {
    jcenter()
    mavenCentral()
}

defaultTasks("shadowJar")

shadowJar {
    manifest {
        attributes("Main-Class": "me.lovesasuna.bot.MainKt")
    }
}

dependencies {
    implementation 'net.mamoe:mirai-console:' + mirai_Version
    implementation 'net.mamoe:mirai-core:' + mirai_Version
    compileOnly 'com.google.auto.service:auto-service:1.0-rc7'
    implementation 'org.jsoup:jsoup:1.13.1'
    implementation 'org.jetbrains.kotlinx:kotlinx-coroutines-core:1.4.1'
    implementation 'dnsjava:dnsjava:3.2.2'
    implementation 'me.lovesasuna:Lanzou:1.3.8'
    implementation "com.fasterxml.jackson.module:jackson-module-kotlin:2.12.1"
    implementation 'com.h2database:h2:1.4.200'
    implementation 'org.hibernate.orm:hibernate-core:6.0.0.Alpha6'
    implementation 'com.charleskorn.kaml:kaml:0.26.0'
    implementation 'com.github.oshi:oshi-core:5.3.6'
    implementation 'net.java.dev.jna:jna:5.6.0'
    implementation 'net.java.dev.jna:jna-platform:5.6.0'
    testImplementation 'org.junit.jupiter:junit-jupiter:5.7.1'
    kapt 'com.google.auto.service:auto-service:1.0-rc7'
}

compileKotlin {
    kotlinOptions {
        jvmTarget = 1.8
    }
    kotlinOptions.useIR = true
}

compileJava {
    options.encoding = 'UTF-8'
    options.compilerArgs.add('-Xlint:deprecation')
    options.compilerArgs.add('-Xlint:unchecked')
}

task copyFile(type: Copy, dependsOn: shadowJar) {
    duplicatesStrategy = DuplicatesStrategy.INCLUDE
    from('build/libs/')
    into(workDir)
    include('Mirai-Bot*.jar')
    rename {
        "Bot.jar"
    }
}

